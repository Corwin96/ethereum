<html>
<head>
    <title>GSNv2 Test</title>
    <script src="https://unpkg.com/web3@latest/dist/web3.min.js"></script> 
    <script src="importmodules\gsn-browserify.js"></script>
<script>
let userAddr   // The user's address
let CaptureTheFlagContract

async function GetJson(url) {
    const f=await fetch(url)
    return await f.json()
}
async function init() {
    userAddr  = (await window.ethereum.enable())[0]
    const nid = window.ethereum.networkVersion   
    if (nid != 4) { alert("I only know the addresses for rinkeby"); return }
    const CaptureTheFlaginfo = await GetJson("build/contracts/CaptureTheFlag.json")
    const PayMasterInfo      = await GetJson("build/contracts/NaivePaymaster.json")
    const PayMasterAdr       = PayMasterInfo.networks[nid].address
	const gsnConfig          = await gsn.resolveConfigurationGSN(window.ethereum,{paymasterAddress: PayMasterAdr})
	const gsnProvider        = new gsn.RelayProvider(window.ethereum, gsnConfig)	
    web3                     = new Web3(gsnProvider)
    CaptureTheFlagContract   = new web3.eth.Contract(CaptureTheFlaginfo.abi,CaptureTheFlaginfo.networks[nid].address) 
}
async function gsnContractCall() {    
    var result=await CaptureTheFlagContract.methods.captureFlag().send({from:userAddr})
    console.log(result.blockHash)
    console.log(result.blockNumber)    
}   
init()
</script>
</head>
<body>
    <h2>GSNv2 Test App</h2>
    <button onClick="gsnContractCall()">Capture the Flag (for free)</button>
</body>
</html>
